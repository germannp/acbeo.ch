{% extends "base.html" %}

{% block title %}Bericht{% endblock title %}

{% block headline %}{{ report.training.date | date:"D., j. E" }}{% endblock headline %}

{% block content %}

<div class="row mt-2">

    <div class="col left">
        <div class="card mb-4">
            <h5 class="card-header">Runs
                {% if request.user.is_orga and report.training.date == today %}
                <a href="{% url 'create_run' %}" class="bi bi-plus-square"></a>
                {% endif %}
            </h5>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm table-hover">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Pilot·in</th>
                                {% for time in times_of_runs %}
                                <th scope="col" class="text-nowrap">{{ time | date:"G:i" }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody class="table-group-divider">
                            {% for pilot, runs in runs_by_pilot.items %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td class="text-nowrap">{{ pilot }} <a href="{% url 'create_bill' date=report.training.date.isoformat pilot=pilot.pk %}" class="bi bi-cart3"></a></td>
                                {% for run in runs %}
                                <td>
                                    {% if run.get_kind_display == 'Flight' %}🪂
                                    {% elif run.get_kind_display == 'Bus' %}🚌
                                    {% elif run.get_kind_display == 'Boat' %}🚢
                                    {% else %}❌{% endif %}
                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                        {% if request.user.is_orga and report.training.date == today %}
                        <tfoot class="table-group-divider">
                            <td></td>
                            <td></td>
                            {% for time in times_of_runs %}
                            <td><a href="{% url 'update_run' run=forloop.counter %}" class="bi bi-pencil-square"></a></td>
                            {% endfor %}
                        </tfoot>
                        {% endif %}
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-lg-4">
        <div class="card mb-4">
            <h5 class="card-header">Kassenstand</h5>
            <div class="card-body">
                <main class="form">
                    <form method="post">
                        {% csrf_token %}
                        <div class="form-floating mb-3">
                            <input type="number" min="0" name="cash_at_start" class="form-control" placeholder="text"
                                {% if form.cash_at_start.value %}value="{{ form.cash_at_start.value }}"{% endif %}>
                            <label>Kassenstand vor dem Training</label>
                        </div>
                        <table class="table table-sm table-hover">
                            <tbody>
                                <tr>
                                    <td>Einnahmen</td>
                                    <td>{{ report.details.revenue }}</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="form-floating mb-3">
                            <input type="number" min="0" name="cash_at_end" class="form-control" placeholder="text"
                                {% if form.cash_at_end.value %}value="{{ form.cash_at_end.value }}"{% endif %}>
                            <label>Kassenstand nach dem Training</label>
                        </div>
                        <button class="btn btn-primary" type="submit">Speichern</button>
                        <a href="javascript:history.back()" class="btn btn-outline-dark">Abbrechen</a>
                    </form>
                </main>
            </div>
        </div>
    </div>

    {% endblock content %}